# Flux World Generation Visualizer

## Goal

Build a single-page HTML application that visualizes the sophisticated world generation system built in `game/src/worldgen`. The application should be completely self-contained and demonstrate the hub-and-spoke topology with dendritic branching patterns.

## World Topology Requirements

### Core Structure: Hub-and-Spoke with Concentric Center

The world generation should create a **hub-and-spoke topology** with:

1. **Concentric Center (3 rings)**:
   - **Inner Ring**: `marsh:tropical` - The sanctuary at the crater center
   - **Middle Ring**: `forest:coniferous` - Dense forest surrounding the marsh
   - **Outer Ring**: `forest:montane` - Mountain forest forming the crater wall

2. **Three Mountain Passes**:
   - Cut through the outer `forest:montane` ring at 120° intervals (0°, 120°, 240°)
   - Each pass serves as the origin point for outward expansion
   - Passes should be clearly visible as gaps in the mountain ring

3. **Three Branching Spokes**:
   - **Spoke A**: Branches into `ruins:tropical` ecosystem network
   - **Spoke B**: Branches into `scrubland:arid` ecosystem network
   - **Spoke C**: Branches into `forest:temperate` ecosystem network
   - Each spoke uses dendritic/fractal branching patterns extending from its mountain pass
   - Spokes should not cross or interconnect (watershed boundary enforcement)

### Ecosystem Distribution

- **Core Ecosystems** (concentric center): 3 types
  - `marsh:tropical` (sanctuary)
  - `forest:coniferous` (inner protection)
  - `forest:montane` (mountain barrier)

- **Peripheral Ecosystems** (branching spokes): 3 types
  - `ruins:tropical` (ancient civilization remnants)
  - `scrubland:arid` (harsh wasteland)
  - `forest:temperate` (accessible woodland)

- **Total Ecosystems**: 6 distinct types

## Core Requirements

### 1. Application Structure
- **Single HTML file** that can be opened directly in a browser
- **Vanilla JavaScript only** - no frameworks, no build tools, no external dependencies
- **Inline CSS and JavaScript** - everything bundled in the HTML file
- **Responsive design** that works on desktop and mobile
- **Real-time generation** with smooth loading states

### 2. Main UI Flow
1. **Configuration Panel**: Allow users to adjust world generation parameters
   - Random seed input (with randomize button)
   - **Hub Configuration**:
     - Concentric ring sizes (marsh radius, forest ring width, mountain ring width)
     - Mountain pass width (how wide the gaps are)
   - **Spoke Configuration**:
     - Branch density per spoke (how many branches per ecosystem type)
     - Branch depth (how far spokes extend from center)
     - Branching angle variation (how organic vs. rigid the patterns are)
   - **Place density** slider (1.0 - 10.0 places per km²)

2. **Generation Controls**:
   - "Generate New World" button (primary action)
   - "Analyze Topology" button
   - "Export World Data" button (JSON download)
   - Loading state with progress indication

3. **Multi-Panel Visualization**:
   - **Spatial View**: 2D map showing the hub-and-spoke topology clearly
   - **Network View**: Graph visualization showing place connections within spokes
   - **Analysis View**: Statistics, charts, and topology analysis
   - **Detail View**: Selected place information with ecosystem and location data

### 3. Visualization Requirements

#### Spatial Map View
- **Concentric Hub**: Clearly visible three rings (marsh, coniferous, montane)
- **Mountain Passes**: Visible gaps in the outer ring at 120° intervals
- **Branching Spokes**: Each spoke should be color-coded by ecosystem type:
  - `ruins:tropical`: Ancient gold/amber colors
  - `scrubland:arid`: Desert browns/tans
  - `forest:temperate`: Fresh greens
- **Dendritic Patterns**: Tree-like branching visible in each spoke
- **Interactive zoom/pan** functionality
- **Place tooltips** on hover with key stats
- **Clickable places** for detailed views

#### Network Graph View
- **Hub Connectivity**: Central rings connected in sequence (marsh → coniferous → montane)
- **Spoke Isolation**: Each spoke network should be visually separate
- **Watershed Boundaries**: No connections between different spokes
- **Branching Hierarchy**: Parent-child relationships visible in spoke networks
- **Ecosystem Clusters**: Places grouped by ecosystem type
- **Force-directed layout** with customizable physics
- **Mountain Pass Connections**: Clear connections from montane ring to spoke origins

#### Analysis Dashboard
- **World Statistics**: Hub ring populations vs. spoke populations
- **Ecosystem Distribution**: Six-segment pie chart for the 6 ecosystem types
- **Spoke Analysis**: Individual metrics for each of the three spokes
- **Topology Metrics**: Hub vs. periphery balance scoring
- **Branching Statistics**: Depth, density, and coverage for each spoke
- **Connectivity Analysis**: Connection patterns and network structure

#### Place Detail Panel
- **Full place information** (name, description, coordinates)
- **Ecosystem Classification**: Which of the 6 ecosystem types
- **Topology Position**: Hub ring vs. spoke branch identification
- **Environmental data** (temperature, humidity, terrain features)
- **Branch Hierarchy**: Parent/child relationships within spoke
- **Mountain Pass Distance**: For spoke places, distance from originating pass

### 4. Technical Implementation

#### Data Integration
- Update ecosystem definitions to use the 6-ecosystem model
- Implement hub-and-spoke generation algorithm:
  - Generate concentric rings first (guaranteed placement)
  - Cut mountain passes at 120° intervals
  - Generate dendritic branches from each pass
  - Enforce watershed boundaries (no cross-spoke connections)
- Convert TypeScript to vanilla JavaScript (remove type annotations)

#### World Generation Algorithm
1. **Phase 1**: Generate concentric hub (marsh → coniferous → montane)
2. **Phase 2**: Create three mountain passes at 0°, 120°, 240°
3. **Phase 3**: Generate branching networks for each spoke:
   - Spoke A (0°): `ruins:tropical` branches
   - Spoke B (120°): `scrubland:arid` branches
   - Spoke C (240°): `forest:temperate` branches
4. **Phase 4**: Connect places within topology rules (hub rings + individual spokes)
5. **Phase 5**: Generate environmental properties with center-to-periphery gradients

### 5. Visual Design Requirements

#### Color Schemes
- **Hub Ecosystems**:
  - `marsh:tropical`: Deep blue-green (sanctuary)
  - `forest:coniferous`: Dark green (protection)
  - `forest:montane`: Brown-green (barrier)
- **Spoke Ecosystems**:
  - `ruins:tropical`: Golden amber (ancient)
  - `scrubland:arid`: Desert tan/brown (harsh)
  - `forest:temperate`: Bright green (accessible)
- **Topology Indicators**:
  - Mountain passes: Clear white/light gaps
  - Spoke boundaries: Subtle dividing lines
  - Branching depth: Gradient from origin to tips

#### Interactive Elements
- **Hub Ring Selection**: Click to select entire concentric rings
- **Spoke Selection**: Click to highlight entire spoke networks
- **Branch Tracing**: Hover to trace from mountain pass to branch tips
- **Ecosystem Filtering**: Toggle visibility by ecosystem type
- **Depth Filtering**: Show/hide by branch depth level

### 6. Data Export Features
- **Hub-Spoke Analysis**: Separate statistics for center vs. each spoke
- **Ecosystem Breakdown**: Distribution across all 6 ecosystem types
- **Topology Validation**: Verify hub-and-spoke structure integrity
- **Branching Metrics**: Depth, density, coverage per spoke
- **PNG Export**: Clear visualization of hub-and-spoke topology

## Technical Notes

- **Topology Priority**: Hub-and-spoke structure is mandatory, not optional
- **Ecosystem Count**: Exactly 6 ecosystems (3 hub + 3 spoke types)
- **Connection Rules**: Hub rings connect sequentially, spokes branch independently
- **Watershed Enforcement**: No connections between different spokes
- **Environmental Gradients**: Varied conditions from center to spoke tips
- **Place Density**: Higher in hub rings, lower but branching in spokes

This application should clearly demonstrate the **hub-and-spoke topology** with **dendritic branching** from **three mountain passes**, making the world structure immediately recognizable and intuitive to explore.
