# Flux World Generation Visualizer

## Goal

Build a single-page HTML application that visualizes the sophisticated world generation system built in `game/src/worldgen`. The application should be completely self-contained and demonstrate the full capabilities of the G.A.E.A. world generation system.

## Core Requirements

### 1. Application Structure
- **Single HTML file** that can be opened directly in a browser
- **Vanilla JavaScript only** - no frameworks, no build tools, no external dependencies
- **Inline CSS and JavaScript** - everything bundled in the HTML file
- **Responsive design** that works on desktop and mobile
- **Real-time generation** with smooth loading states

### 2. Main UI Flow
1. **Configuration Panel**: Allow users to adjust world generation parameters
   - Random seed input (with randomize button)
   - Ecosystem distribution sliders (Forest, Grassland, Mountain types)
   - G.A.E.A. intensity slider (0.0 - 1.0)
   - Fungal spread factor slider (0.0 - 1.0)
   - Worshipper density slider (0.0 - 1.0)
   - Place density slider (1.0 - 10.0 places per kmÂ²)

2. **Generation Controls**:
   - "Generate New World" button (primary action)
   - "Analyze Anti-Equilibrium" button
   - "Export World Data" button (JSON download)
   - Loading state with progress indication

3. **Multi-Panel Visualization**:
   - **Spatial View**: 2D map showing place locations, topology zones, and ecosystem types
   - **Network View**: Graph visualization showing place connections and relationships
   - **Analysis View**: Statistics, charts, and anti-equilibrium analysis
   - **Detail View**: Selected place information with full G.A.E.A. properties

### 3. Visualization Requirements

#### Spatial Map View
- **Hub-and-spoke topology** clearly visible (plateau, mountain ring, ecosystem slices)
- **Color-coded ecosystems** with legend
- **G.A.E.A. intensity heatmap** overlays
- **Infection zones** highlighted with special styling
- **Worshipper territories** marked with distinct indicators
- **Interactive zoom/pan** functionality
- **Place tooltips** on hover with key stats
- **Clickable places** for detailed views

#### Network Graph View
- **Place connections** using the generated exits system (automatically created reciprocal exits)
- **Ecosystem clusters** grouped visually
- **G.A.E.A. management flow** between related places
- **Force-directed layout** with customizable physics
- **Infection spread vectors** shown as directed edges
- **Worshipper territory boundaries** visualized
- **Exit relationships** displayed as labeled edges with direction and destination info

#### Analysis Dashboard
- **World statistics** summary (total places, zones, territories)
- **Ecosystem distribution** pie chart
- **Anti-equilibrium metrics** with scoring (0-5 scale)
- **G.A.E.A. gradient analysis** with heat visualization
- **Fungal cultivation sites** count and distribution
- **Worshipper behavior profiles** breakdown
- **Temperature/pressure/humidity** distribution histograms

#### Place Detail Panel
- **Full place information** (name, description, coordinates)
- **G.A.E.A. management profile** with all properties
- **Cordyceps habitat data** (shade, humidity, infection risk)
- **Worshipper behavior** profile details
- **Ecological profile** (ecosystem URN, temperature/pressure/humidity ranges)
- **Current weather** (temperature, pressure, humidity, precipitation, ppfd, clouds)
- **Resource generation** capabilities (available resources, capacity, production rates)
- **Exits** to connected places with directions and labels
- **Topology zone** and distance from center

### 4. Technical Implementation

#### Data Integration
- Copy and bundle the complete worldgen system from `game/src/worldgen/` into vanilla JavaScript
- Use existing `generateWorld()` function for world creation
- Leverage `analyzeAntiEquilibrium()` for world analysis
- Utilize `WorldGenUtils` for formatting and statistics
- Include all ecosystem profiles and G.A.E.A. management data
- Convert TypeScript to vanilla JavaScript (remove type annotations)
- **Full Place data structure** available: The worldgen system generates complete Place objects with:
  - `ecology` (EcosystemURN + temperature/pressure/humidity ranges)
  - `weather` (current temperature, pressure, humidity, precipitation, ppfd, clouds)
  - `exits` (directional connections to other places)
  - `entities` (empty in generated worlds)
  - `resources` (ResourceGenerator with available/capacity/production data)
  - Plus all G.A.E.A. extensions (management profiles, cordyceps habitat, worshipper behavior)

#### Performance Optimizations
- Maintain the **O(N) generation performance** of the existing system
- Use **canvas rendering** for spatial visualizations (not DOM manipulation)
- Implement **virtualization** for large place lists
- **Debounce** parameter changes to avoid excessive regeneration
- **Progressive loading** for complex visualizations

#### User Experience
- **Intuitive controls** with clear labels and help text
- **Responsive feedback** for all interactions
- **Smooth transitions** between different views
- **Persistent state** in URL hash for sharing configurations
- **Error handling** with user-friendly messages
- **Mobile-optimized** touch interactions

### 5. Visual Design Requirements

#### Color Schemes
- **Ecosystem colors**: Distinct, accessible colors for each ecosystem type
- **G.A.E.A. intensity**: Red gradient (low to high management)
- **Infection zones**: Green highlights for fungal cultivation areas
- **Worshipper territories**: Blue/purple indicators
- **Topology zones**: Subtle background shading (plateau, mountain, slices)

#### Interactive Elements
- **Smooth hover effects** with informative tooltips
- **Clear selection states** for clicked places
- **Responsive button states** (loading, disabled, active)
- **Progress indicators** for generation and analysis
- **Zoom controls** for map navigation
- **Filter toggles** for different data layers

### 6. Data Export Features
All exports trigger the browser's standard file download dialog using `URL.createObjectURL()` and programmatic link clicks:

- **JSON export** of generated world data (`world-data.json`)
- **Game format export** - converts generated GAEAPlace objects to the specific PlaceInput format used in the game system (`places.json`):
  ```javascript
  {
    id: 'flux:place:generated:place-name',
    name: 'Place Name',
    description: 'Generated description...',
    exits: {
      [Direction.NORTH]: {
        to: 'flux:place:generated:other-place',
        direction: Direction.NORTH,
        label: 'Travel north to...'
      }
    }
    // Optional: include resources if ResourceGenerator data is present
  }
  ```
  This strips out the G.A.E.A.-specific properties and keeps only the core Place data needed for the game.
- **Configuration sharing** via URL parameters (no download, just URL update)
- **PNG export** of current map view (`world-map.png`) using canvas `.toDataURL()`
- **CSV export** of place statistics (`place-stats.csv`)
- **Analysis report** export with key metrics (`world-analysis.json`)

## Technical Notes

- The worldgen system is **pure and deterministic** - leverage this for reproducible results
- All **ecosystem profiles** and **G.A.E.A. management data** are pre-defined in the existing types
- The system generates **realistic place graphs** with proper spatial relationships
- **Anti-equilibrium analysis** provides sophisticated world quality metrics
- Use **vanilla JavaScript** throughout - no frameworks or external dependencies
- Convert existing TypeScript worldgen code to vanilla JS by removing type annotations
- All functionality should work in modern browsers without build tools
- **Complete Place data structure**: Reference `game/src/types/entity/place.ts` for the full Place type definition
- **Export format**: Include conversion from GAEAPlace format to the game's PlaceInput format (matching `game/src/fixtures/place/nightcity.ts` structure)
- **Rich visualization data**: Generated places include ecology, weather, resources, and **fully populated exits** - all displayable in the UI
- **Exits are automatically generated**: The worldgen system now creates reciprocal exits between spatially proximate places with meaningful labels

This application should demonstrate the full sophistication of the G.A.E.A. world generation system while being accessible to users who want to explore and understand the complex world-building mechanics.
